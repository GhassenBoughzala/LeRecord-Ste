"use strict";var e=require("autoprefixer"),s=require("cssdb"),t=require("@csstools/postcss-progressive-custom-properties"),o=require("fs"),r=require("path"),i=require("browserslist"),n=require("postcss-attribute-case-insensitive"),c=require("css-blank-pseudo"),u=require("postcss-color-functional-notation"),a=require("postcss-color-hex-alpha"),l=require("postcss-color-rebeccapurple"),p=require("postcss-custom-media"),f=require("postcss-custom-properties"),d=require("postcss-custom-selectors"),m=require("postcss-dir-pseudo-class"),g=require("postcss-double-position-gradients"),b=require("postcss-env-function"),h=require("postcss-focus-visible"),y=require("postcss-focus-within"),w=require("postcss-font-variant"),v=require("postcss-gap-properties"),$=require("css-has-pseudo"),q=require("postcss-image-set-function"),k=require("postcss-initial"),O=require("postcss-lab-function"),S=require("postcss-logical"),j=require("postcss-media-minmax"),x=require("postcss-nesting"),P=require("postcss-overflow-shorthand"),E=require("postcss-page-break"),M=require("postcss-place"),_=require("css-prefers-color-scheme"),R=require("postcss-pseudo-class-any-link"),A=require("postcss-replace-overflow-wrap"),F=require("postcss-selector-not"),N=require("@csstools/postcss-is-pseudo-class"),T=require("@csstools/postcss-hwb-function"),B=require("postcss-opacity-percentage"),U=require("postcss-clamp"),W=require("@csstools/postcss-font-format-keywords"),C=require("@csstools/postcss-normalize-display-values");function I(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var V=I(e),D=I(s),L=I(t),J=I(o),z=I(r),G=I(i),H=I(n),K=I(c),Q=I(u),X=I(a),Y=I(l),Z=I(p),ee=I(f),se=I(d),te=I(m),oe=I(g),re=I(b),ie=I(h),ne=I(y),ce=I(w),ue=I(v),ae=I($),le=I(q),pe=I(k),fe=I(O),de=I(S),me=I(j),ge=I(x),be=I(P),he=I(E),ye=I(M),we=I(_),ve=I(R),$e=I(A),qe=I(F),ke=I(N),Oe=I(T),Se=I(B),je=I(U),xe=I(W),Pe=I(C);const Ee={"blank-pseudo-class":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-blank-pseudo/README-BROWSER.md","focus-visible-pseudo-class":"https://github.com/WICG/focus-visible","focus-within-pseudo-class":"https://github.com/jsxtools/focus-within/blob/master/README-BROWSER.md","has-pseudo-class":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-has-pseudo/README-BROWSER.md","prefers-color-scheme-query":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-prefers-color-scheme/README-BROWSER.md"},Me=["blank-pseudo-class","focus-visible-pseudo-class","focus-within-pseudo-class","has-pseudo-class","prefers-color-scheme-query"];async function _e(e,s,t,o){const r=function(e){return`:root {\n${Object.keys(e).reduce(((s,t)=>(s.push(`\t${t}: ${e[t]};`),s)),[]).join("\n")}\n}\n`}(t),i=function(e){return`${Object.keys(e).reduce(((s,t)=>(s.push(`@custom-media ${t} ${e[t]};`),s)),[]).join("\n")}\n`}(s),n=function(e){return`${Object.keys(e).reduce(((s,t)=>(s.push(`@custom-selector ${t} ${e[t]};`),s)),[]).join("\n")}\n`}(o),c=`${i}\n${n}\n${r}`;await Te(e,c)}function Re(e,s){return`\n\t${e}: {\n${Object.keys(s).reduce(((e,t)=>(e.push(`\t\t'${Be(t)}': '${Be(s[t])}'`),e)),[]).join(",\n")}\n\t}`}function Ae(e,s){return`export const ${e} = {\n${Object.keys(s).reduce(((e,t)=>(e.push(`\t'${Be(t)}': '${Be(s[t])}'`),e)),[]).join(",\n")}\n};\n`}function Fe(e,s){return Promise.all([].concat(s).map((async s=>{if(s instanceof Function)await s({customMedia:Ne(e.customMedia),customProperties:Ne(e.customProperties),customSelectors:Ne(e.customSelectors)});else{const t=s===Object(s)?s:{to:String(s)},o=t.toJSON||Ne;if("customMedia"in t||"customProperties"in t||"customSelectors"in t)t.customMedia=o(e.customMedia),t.customProperties=o(e.customProperties),t.customSelectors=o(e.customSelectors);else if("custom-media"in t||"custom-properties"in t||"custom-selectors"in t)t["custom-media"]=o(e.customMedia),t["custom-properties"]=o(e.customProperties),t["custom-selectors"]=o(e.customSelectors);else{const s=String(t.to||""),r=(t.type||z.default.extname(t.to).slice(1)).toLowerCase(),i=o(e.customMedia),n=o(e.customProperties),c=o(e.customSelectors);"css"===r&&await _e(s,i,n,c),"js"===r&&await async function(e,s,t,o){const r=`module.exports = {${Re("customMedia",s)},${Re("customProperties",t)},${Re("customSelectors",o)}\n};\n`;await Te(e,r)}(s,i,n,c),"json"===r&&await async function(e,s,t,o){const r=`${JSON.stringify({"custom-media":s,"custom-properties":t,"custom-selectors":o},null,"  ")}\n`;await Te(e,r)}(s,i,n,c),"mjs"===r&&await async function(e,s,t,o){const r=`${Ae("customMedia",s)}\n${Ae("customProperties",t)}\n${Ae("customSelectors",o)}`;await Te(e,r)}(s,i,n,c)}}})))}function Ne(e){return Object.keys(e).reduce(((s,t)=>(s[t]=String(e[t]),s)),{})}function Te(e,s){return new Promise(((t,o)=>{J.default.writeFile(e,s,(e=>{e?o(e):t()}))}))}function Be(e){return e.replace(/\\([\s\S])|(')/g,"\\$1$2").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function Ue(e,s){if(!e)return!1;if("string"==typeof e)return!0;if(Array.isArray(e)){for(let t=0;t<e.length;t++){if("string"==typeof e[t])return!0;if(e[t]&&s in Object(e[t]))return!0}return!1}return s in Object(e)}function We(e,s,t){return Math.max(e,Math.min(s,t))}const Ce=Symbol("insertBefore"),Ie=Symbol("insertAfter"),Ve=Symbol("insertOrder"),De=Symbol("plugin");function Le(e,s,t){if("insertBefore"!==t&&"insertAfter"!==t)return[];const o="insertBefore"===t?Ce:Ie,r=[];for(const t in s){if(!Object.hasOwnProperty.call(s,t))continue;if(!e.find((e=>e.id===t)))continue;let i=s[t];Array.isArray(i)||(i=[i]);for(let e=0;e<i.length;e++)r.push({id:t,[De]:i[e],[Ve]:e,[o]:!0})}return r}var Je=["custom-media-queries","custom-properties","environment-variables","image-set-function","media-query-ranges","prefers-color-scheme-query","nesting-rules","custom-selectors","any-link-pseudo-class","case-insensitive-attributes","focus-visible-pseudo-class","focus-within-pseudo-class","not-pseudo-class","logical-properties-and-values","dir-pseudo-class","all-property","color-functional-notation","double-position-gradients","hexadecimal-alpha-notation","hwb-function","lab-function","rebeccapurple-color","blank-pseudo-class","break-properties","font-variant-property","is-pseudo-class","has-pseudo-class","gap-properties","overflow-property","overflow-wrap-property","place-properties","system-ui-font-family"];function ze(){return{postcssPlugin:"postcss-system-ui-font",Declaration(e){Ge.test(e.prop)&&(e.value.includes(Ke.join(", "))||(e.value=e.value.replace(Qe,Xe)))}}}ze.postcss=!0;const Ge=/(?:^(?:-|\\002d){2})|(?:^font(?:-family)?$)/i,He="[\\f\\n\\r\\x09\\x20]",Ke=["system-ui","-apple-system","Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans","sans-serif"],Qe=new RegExp(`(^|,|${He}+)(?:system-ui${He}*)(?:,${He}*(?:${Ke.join("|")})${He}*)?(,|$)`,"i"),Xe=`$1${Ke.join(", ")}$2`,Ye={"css-blank-pseudo":"blank-pseudo-class","css-has-pseudo":"has-pseudo-class","css-prefers-color-scheme":"prefers-color-scheme-query","postcss-attribute-case-insensitive":"case-insensitive-attributes","postcss-clamp":"clamp","postcss-color-functional-notation":"color-functional-notation","postcss-color-hex-alpha":"hexadecimal-alpha-notation","postcss-color-rebeccapurple":"rebeccapurple-color","postcss-custom-media":"custom-media-queries","postcss-custom-properties":"custom-properties","postcss-custom-selectors":"custom-selectors","postcss-dir-pseudo-class":"dir-pseudo-class","postcss-double-position-gradients":"double-position-gradients","postcss-env-function":"environment-variables","postcss-focus-visible":"focus-visible-pseudo-class","postcss-focus-within":"focus-within-pseudo-class","postcss-font-format-keywords":"font-format-keywords","postcss-font-variant":"font-variant-property","postcss-gap-properties":"gap-properties","postcss-hwb-function":"hwb-function","postcss-image-set-function":"image-set-function","postcss-initial":"all-property","postcss-is-pseudo-class":"is-pseudo-class","postcss-lab-function":"lab-function","postcss-logical":"logical-properties-and-values","postcss-media-minmax":"media-query-ranges","postcss-nesting":"nesting-rules","postcss-normalize-display-values":"display-two-values","postcss-opacity-percentage":"opacity-percentage","postcss-overflow-shorthand":"overflow-property","postcss-page-break":"break-properties","postcss-place":"place-properties","postcss-pseudo-class-any-link":"any-link-pseudo-class","postcss-replace-overflow-wrap":"overflow-wrap-property","postcss-selector-not":"not-pseudo-class","postcss-system-ui-font-family":"system-ui-font-family"},Ze=(()=>{const e={};for(const[s,t]of Object.entries(Ye))e[t]=s;return e})(),es=new Map([["all-property",pe.default],["any-link-pseudo-class",ve.default],["blank-pseudo-class",K.default],["break-properties",he.default],["case-insensitive-attributes",H.default],["clamp",je.default],["color-functional-notation",Q.default],["custom-media-queries",Z.default],["custom-properties",ee.default],["custom-selectors",se.default],["dir-pseudo-class",te.default],["display-two-values",Pe.default],["double-position-gradients",oe.default],["environment-variables",re.default],["focus-visible-pseudo-class",ie.default],["focus-within-pseudo-class",ne.default],["font-format-keywords",xe.default],["font-variant-property",ce.default],["gap-properties",ue.default],["hwb-function",Oe.default],["has-pseudo-class",ae.default],["hexadecimal-alpha-notation",X.default],["image-set-function",le.default],["is-pseudo-class",ke.default],["lab-function",fe.default],["logical-properties-and-values",de.default],["media-query-ranges",me.default],["nesting-rules",ge.default],["not-pseudo-class",qe.default],["opacity-percentage",Se.default],["overflow-property",be.default],["overflow-wrap-property",$e.default],["place-properties",ye.default],["prefers-color-scheme-query",we.default],["rebeccapurple-color",Y.default],["system-ui-font-family",ze]]);function ss(e,s,t){return e.concat(Le(e,s,"insertBefore"),Le(e,t,"insertAfter")).filter((e=>function(e){return!!e[Ce]||!!e[Ie]||!!es.has(e.id)}(e))).sort(((e,s)=>function(e,s){return e.id===s.id?e[Ce]&&s[Ce]||e[Ie]&&s[Ie]?We(-1,e[Ve]-s[Ve],1):e[Ce]||s[Ie]?-1:e[Ie]||s[Ce]?1:0:We(-1,Je.indexOf(e.id)-Je.indexOf(s.id),1)}(e,s)))}const ts=["ie","edge","firefox","chrome","safari","opera","ios_saf","android","op_mob","and_chr","and_ff","and_uc","samsung","and_qq","baidu","kaios"];function os(e){if(!e)return[];if(!("browser_support"in e))return["> 0%"];const s=[];return ts.forEach((t=>{const o=e.browser_support[t];"string"==typeof o&&/^[0-9|.]+$/.test(o)?s.push(`${t} < ${e.browser_support[t]}`):s.push(`${t} >= 1`)})),s}function rs(e,s,t,o){const r=G.default(e,{ignoreUnknownVersions:!0});switch(s.id){case"is-pseudo-class":return{onComplexSelector:"warning"};case"nesting-rules":if(function(e,s){const t=os(e);if(s.some((e=>G.default(t,{ignoreUnknownVersions:!0}).some((s=>s===e)))))return!0;return!1}(t.find((e=>"is-pseudo-class"===e.id)),r))return o.log('Disabling :is on "nesting-rules" due to lack of browser support.'),{noIsPseudoSelector:!0};return{};case"any-link-pseudo-class":if(r.find((e=>e.startsWith("ie ")||e.startsWith("edge "))))return o.log('Adding area[href] fallbacks for ":any-link" support in Edge and IE.'),{subFeatures:{areaHrefNeedsFixing:!0}};return{};default:return{}}}function is(e,s,t,o){const r=Object(s.features),i=!("enableClientSidePolyfills"in s)||s.enableClientSidePolyfills,n=Object(s.insertBefore),c=Object(s.insertAfter),u=s.browsers,a=We(0,function(e){const s=parseInt(e,10);return Number.isNaN(s)?0:s}(s.minimumVendorImplementations),3);a>0&&o.log(`Using features with ${a} or more vendor implementations`);const l=function(e,s){let t=2;if(void 0===e.stage)return s.log(`Using features from Stage ${t} (default)`),t;if(!1===e.stage)t=5;else{let s=parseInt(e.stage,10);Number.isNaN(s)&&(s=0),t=We(0,s,5)}return 5===t?s.log('Stage has been disabled, features will be handled via the "features" option.'):s.log(`Using features from Stage ${t}`),t}(s,o);2===l&&t&&!1===t.preserve&&(e=JSON.parse(JSON.stringify(e))).forEach((e=>{("blank-pseudo-class"===e.id||"prefers-color-scheme-query"===e.id)&&(e.stage=1)}));const p=ss(e,n,c).map((e=>function(e){const s=os(e);if(e[Ce]||e[Ie]){let t=e.id;return t=e.insertBefore?`before-${t}`:`after-${t}`,{browsers:s,vendors_implementations:e.vendors_implementations,plugin:e[De],id:t,stage:6}}return{browsers:s,vendors_implementations:e.vendors_implementations,plugin:es.get(e.id),id:e.id,stage:e.stage}}(e))).filter((e=>0===a||(!(!e[Ce]&&!e[Ie])||(a<=e.vendors_implementations||(o.log(`  ${e.id} with ${e.vendors_implementations} vendor implementations has been disabled`),!1))))).filter((e=>{const s=e.stage>=l,t=i||!Me.includes(e.id),n=!1===r[e.id],c=r[e.id]?r[e.id]:s&&t;return n?o.log(`  ${e.id} has been disabled by options`):s?t||o.log(`  ${e.id} has been disabled by "enableClientSidePolyfills: false".`):c?o.log(`  ${e.id} has been enabled by options`):o.log(`  ${e.id} with stage ${e.stage} has been disabled`),c})).map((s=>function(e,s,t,o,r,i){let n,c;return n=rs(s,o,e,i),!0===t[o.id]?r&&(n=Object.assign({},n,r)):n=r?Object.assign({},n,r,t[o.id]):Object.assign({},n,t[o.id]),n.enableProgressiveCustomProperties=!1,c=o.plugin.postcss&&"function"==typeof o.plugin?o.plugin(n):o.plugin&&o.plugin.default&&"function"==typeof o.plugin.default&&o.plugin.default.postcss?o.plugin.default(n):o.plugin,{browsers:o.browsers,vendors_implementations:o.vendors_implementations,plugin:c,pluginOptions:n,id:o.id}}(e,u,r,s,t,o))),f=G.default(u,{ignoreUnknownVersions:!0});return p.filter((e=>{if(e.id in r)return r[e.id];if(function(e){if("importFrom"in Object(e.pluginOptions))switch(e.id){case"custom-media-queries":if(Ue(e.pluginOptions.importFrom,"customMedia"))return!0;break;case"custom-properties":if(Ue(e.pluginOptions.importFrom,"customProperties"))return!0;break;case"environment-variables":if(Ue(e.pluginOptions.importFrom,"environmentVariables"))return!0;break;case"custom-selectors":if(Ue(e.pluginOptions.importFrom,"customSelectors"))return!0}if("exportTo"in Object(e.pluginOptions))switch(e.id){case"custom-media-queries":if(Ue(e.pluginOptions.exportTo,"customMedia"))return!0;break;case"custom-properties":if(Ue(e.pluginOptions.exportTo,"customProperties"))return!0;break;case"environment-variables":if(Ue(e.pluginOptions.exportTo,"environmentVariables"))return!0;break;case"custom-selectors":if(Ue(e.pluginOptions.exportTo,"customSelectors"))return!0}return!1}(e))return!0;const s=G.default(e.browsers,{ignoreUnknownVersions:!0}),t=f.some((e=>s.some((s=>s===e))));return t||o.log(`${e.id} disabled due to browser support`),t}))}class ns{constructor(){this.logs=[]}log(e){this.logs.push(e)}resetLogger(){this.logs.length=0}dumpLogs(e){e&&this.logs.forEach((s=>e.warn(s))),this.resetLogger()}}function cs(e,s){let t="unknown",o=1/0;for(let r=0;r<s.length;r++){const i=us(e,s[r]);i<o&&(o=i,t=s[r])}return{mostSimilar:t,distance:o}}function us(e,s){if(!e.length)return s.length;if(!s.length)return e.length;const t=[];for(let o=0;o<=s.length;o++){t[o]=[o];for(let r=1;r<=e.length;r++)t[o][r]=0===o?r:Math.min(t[o-1][r]+1,t[o][r-1]+1,t[o-1][r-1]+(e[r-1]===s[o-1]?0:1))}return t[s.length][e.length]}const as=e=>{const s=new ns,t=Object(e),o=Object.keys(Object(t.features)),r=t.browsers,i=function(e){if("importFrom"in e||"exportTo"in e||"preserve"in e){const s={};return"importFrom"in e&&(s.importFrom=e.importFrom),"exportTo"in e&&(s.exportTo={customMedia:{},customProperties:{},customSelectors:{}}),"preserve"in e&&(s.preserve=e.preserve),s}return!1}(t),n=is(D.default,t,i,s),c=n.map((e=>e.plugin));!1!==t.autoprefixer&&c.push(V.default(Object.assign({overrideBrowserslist:r},t.autoprefixer))),c.push(L.default()),function(e,s,t){if(s.debug){t.log("Enabling the following feature(s):");const s=[];e.forEach((e=>{e.id.startsWith("before")||e.id.startsWith("after")?t.log(`  ${e.id} (injected via options)`):t.log(`  ${e.id}`),void 0!==Ee[e.id]&&s.push(e.id)})),s.length&&(t.log("These feature(s) need a browser library to work:"),s.forEach((e=>t.log(` ${e}: ${Ee[e]}`))))}}(n,t,s);const u=()=>({postcssPlugin:"postcss-preset-env",OnceExit:function(r,{result:n}){!function(e,s,t){const o=Object.keys(Ze),r=Object.keys(Ye);e.forEach((e=>{if(o.includes(e))return;const i=cs(e,o),n=cs(e,r);i.distance<n.distance?s.warn(t,`Unknown feature: "${e}" did you mean: "${i.mostSimilar}"`):s.warn(t,`Unknown feature: "${e}" did you mean: "${Ye[n.mostSimilar]}"`)}))}(o,r,n),t.debug&&s.dumpLogs(n),s.resetLogger(),t.exportTo&&Fe(i.exportTo,e.exportTo)}});return u.postcss=!0,{postcssPlugin:"postcss-preset-env",plugins:[...c,u()]}};as.postcss=!0,module.exports=as;
